<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Regent Connect ‚Äî Login / Register</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#94a3b8;--accent:#4f46e5;--success:#10b981;--error:#ef4444}
    *{box-sizing:border-box;margin:0;padding:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial}
    html,body{height:100%;background:linear-gradient(180deg,#071126 0%, #071b2a 100%);color:#e6eef8}
    .auth-page{display:flex;align-items:center;justify-content:center;min-height:100vh;padding:20px}
    .auth-container{width:100%;max-width:440px}
    .brand{text-align:center;margin-bottom:32px}
    .logo{width:80px;height:80px;border-radius:20px;background:linear-gradient(135deg,var(--accent),#06b6d4);display:inline-flex;align-items:center;justify-content:center;font-weight:700;font-size:32px;color:white;margin-bottom:16px;box-shadow:0 8px 24px rgba(79,70,229,0.4)}
    .brand h1{font-size:28px;margin-bottom:8px}
    .tag{color:var(--muted);font-size:14px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:16px;padding:32px;box-shadow:0 8px 24px rgba(2,6,23,0.7);border:1px solid rgba(255,255,255,0.04)}
    .card h2{font-size:22px;margin-bottom:24px}
    form label{display:block;margin-bottom:16px;font-size:14px;font-weight:500}
    form input{width:100%;padding:12px;margin-top:6px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#fff;font-size:14px;transition:all .2s}
    form input:focus{outline:none;border-color:var(--accent);background:rgba(255,255,255,0.04)}
    .row{display:flex;align-items:center}
    .row.between{justify-content:space-between;margin-bottom:20px}
    .checkbox{display:flex;align-items:center;gap:6px;font-size:13px;cursor:pointer;user-select:none}
    .checkbox input{width:auto;margin:0}
    a{color:var(--accent);text-decoration:none;font-size:13px;transition:color .2s}
    a:hover{color:#6366f1;text-decoration:underline}
    .btn{width:100%;padding:12px;border-radius:10px;border:none;background:var(--accent);color:white;font-weight:600;cursor:pointer;transition:all .2s;font-size:14px}
    .btn:hover{background:#4338ca;transform:translateY(-1px);box-shadow:0 4px 12px rgba(79,70,229,0.4)}
    .btn:active{transform:translateY(0)}
    .auth-footer{text-align:center;margin-top:24px;font-size:13px;color:var(--muted)}
    .error-msg{background:var(--error);color:white;padding:12px;border-radius:8px;margin-bottom:16px;font-size:14px;animation:slideIn .3s}
    .success-msg{background:var(--success);color:white;padding:12px;border-radius:8px;margin-bottom:16px;font-size:14px;animation:slideIn .3s}
    @keyframes slideIn{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:none}}
    [hidden]{display:none!important}
    .floating-ai-btn {
      position: fixed;
      bottom: 24px;
      right: 24px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      cursor: pointer;
      box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 1000;
      animation: float 3s ease-in-out infinite;
    }
    
    .floating-ai-btn:hover {
      transform: translateY(-4px) scale(1.1);
      box-shadow: 0 12px 32px rgba(102, 126, 234, 0.6);
    }
    
    .floating-ai-btn:active {
      transform: translateY(-2px) scale(1.05);
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    
    @media (max-width: 768px) {
      .floating-ai-btn {
        bottom: 16px;
        right: 16px;
        width: 52px;
        height: 52px;
        font-size: 24px;
      }
    }
  </style>
</head>
<body class="auth-page">
  <main class="auth-container">
    <div class="brand">
      <div class="logo">RC</div>
      <h1>Regent Connect</h1>
      <p class="tag">Chat. Learn. Connect.</p>
    </div>

    <section class="auth-cards">
      <div class="card login-card" id="loginCard">
        <h2>Welcome back</h2>
        <div id="loginError"></div>
        <form id="loginForm">
          <label>Email, Phone or Username
            <input type="text" id="loginIdentifier" placeholder="Enter your identifier" required autofocus>
          </label>
          <label>Password
            <input type="password" id="loginPassword" placeholder="Enter password" required>
          </label>
          <div class="row between">
            <label class="checkbox">
              <input type="checkbox" id="remember"> Remember me
            </label>
            <a href="#" id="showRegister">Create account</a>
          </div>
          <button type="submit" class="btn primary">Sign in</button>
        </form>
      </div>

      <div class="card register-card" id="registerCard" hidden>
        <h2>Create account</h2>
        <div id="registerError"></div>
        <form id="registerForm">
          <label>Full name
            <input type="text" id="regName" placeholder="Enter your full name" required>
          </label>
          <label>Phone or Email
            <input type="text" id="regIdentifier" placeholder="+233 or email@example.com" required>
          </label>
          <label>Password
            <input type="password" id="regPassword" placeholder="Create password (min 6 chars)" required>
          </label>
          <label>Bio (optional)
            <input type="text" id="regBio" placeholder="Tell us about yourself">
          </label>
          <div class="row between">
            <a href="#" id="showLogin">Back to login</a>
            <button type="submit" class="btn primary">Register</button>
          </div>
        </form>
      </div>
    </section>

    <footer class="auth-footer">
      <small>By continuing you agree to our <a href="#">Terms</a> and <a href="#">Privacy</a>.</small>
    </footer>
  </main>

  <!-- Floating AI Button -->
  <div class="floating-ai-btn" onclick="openAIWithPrompt()" title="Try RegentAI">
    ü§ñ
  </div>

  <script>
    /* ====== Database helpers (shared with chat.html) ====== */
    const DB = {
      load(key, defaultVal){try{const v=localStorage.getItem(key);return v?JSON.parse(v):defaultVal}catch(e){return defaultVal}},
      save(key,val){localStorage.setItem(key,JSON.stringify(val))}
    };
    const KEY = {USERS:'rc_users',CUR:'rc_currentUser',REQS:'rc_reqs',MSGS:'rc_msgs',GROUPS:'rc_groups'};

    /* Utilities */
    function uid(prefix='u'){return prefix+Math.random().toString(36).slice(2,9)}
    function randomColor(){const c=['#ef4444','#f97316','#06b6d4','#10b981','#8b5cf6','#ef6b8a','#f59e0b','#eab308'];return c[Math.floor(Math.random()*c.length)]}

    /* Seed sample users if none */
    function seed(){
      let users = DB.load(KEY.USERS,[]);
      if(users.length===0){
        users = [
          {id:uid(),name:'Philip',phone:'+233201234567',password:'demo123',about:'Level 300 ‚Äî CS',avatarColor:'#ef4444',friends:[]},
          {id:uid(),name:'Nana',phone:'+233245000123',password:'demo123',about:'Robotics Club',avatarColor:'#f97316',friends:[]},
          {id:uid(),name:'Akosua',phone:'+233244999888',password:'demo123',about:'STEMAID',avatarColor:'#06b6d4',friends:[]},
          {id:'bot_ai',name:'Regent AI',phone:'',password:'',about:'Simulated assistant',avatarColor:'#4f46e5',friends:[]}
        ];
        DB.save(KEY.USERS,users);
      }
      if(!DB.load(KEY.MSGS)) DB.save(KEY.MSGS,[]);
      if(!DB.load(KEY.REQS)) DB.save(KEY.REQS,[]);
      if(!DB.load(KEY.GROUPS)) DB.save(KEY.GROUPS,[]);
    }
    seed();

    /* DOM Elements */
    const loginCard = document.getElementById('loginCard');
    const registerCard = document.getElementById('registerCard');
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    const loginError = document.getElementById('loginError');
    const registerError = document.getElementById('registerError');

    /* Show/Hide Forms */
    document.getElementById('showRegister').addEventListener('click', (e)=>{
      e.preventDefault();
      loginCard.hidden = true;
      registerCard.hidden = false;
      document.getElementById('regName').focus();
      clearErrors();
    });

    document.getElementById('showLogin').addEventListener('click', (e)=>{
      e.preventDefault();
      loginCard.hidden = false;
      registerCard.hidden = true;
      document.getElementById('loginIdentifier').focus();
      clearErrors();
    });

    /* Clear error messages */
    function clearErrors(){
      loginError.innerHTML = '';
      registerError.innerHTML = '';
    }

    /* Show error message */
    function showError(elementId, message){
      const el = document.getElementById(elementId);
      el.innerHTML = `<div class="error-msg">‚ùå ${message}</div>`;
      setTimeout(()=>el.innerHTML='', 5000);
    }

    /* Show success message */
    function showSuccess(elementId, message){
      const el = document.getElementById(elementId);
      el.innerHTML = `<div class="success-msg">‚úÖ ${message}</div>`;
    }

    /* Login Handler */
    loginForm.addEventListener('submit', (e)=>{
      e.preventDefault();
      clearErrors();

      const identifier = document.getElementById('loginIdentifier').value.trim();
      const password = document.getElementById('loginPassword').value;
      const remember = document.getElementById('remember').checked;

      if(!identifier || !password){
        showError('loginError', 'Please fill in all fields');
        return;
      }

      const users = DB.load(KEY.USERS,[]);
      const user = users.find(u=>
        u.name.toLowerCase() === identifier.toLowerCase() ||
        u.phone === identifier ||
        u.id === identifier ||
        (u.email && u.email.toLowerCase() === identifier.toLowerCase())
      );

      if(!user){
        showError('loginError', 'User not found. Please register first.');
        return;
      }

      // Check password (demo users have password field, new users might not)
      if(user.password && user.password !== password){
        showError('loginError', 'Incorrect password');
        return;
      }

      // Successful login
      DB.save(KEY.CUR, user);
      if(remember){
        localStorage.setItem('rc_remember', 'true');
      }

      showSuccess('loginError', 'Login successful! Redirecting...');
      setTimeout(()=>{
        window.location.href = 'chat.html';
      }, 1000);
    });

    /* Register Handler */
    registerForm.addEventListener('submit', (e)=>{
      e.preventDefault();
      clearErrors();

      const name = document.getElementById('regName').value.trim();
      const identifier = document.getElementById('regIdentifier').value.trim();
      const password = document.getElementById('regPassword').value;
      const bio = document.getElementById('regBio').value.trim();

      // Validation
      if(!name || !identifier || !password){
        showError('registerError', 'Please fill in all required fields');
        return;
      }

      if(name.length < 2){
        showError('registerError', 'Name must be at least 2 characters');
        return;
      }

      if(password.length < 6){
        showError('registerError', 'Password must be at least 6 characters');
        return;
      }

      const users = DB.load(KEY.USERS,[]);

      // Check if user already exists
      const exists = users.find(u=>
        u.name.toLowerCase() === name.toLowerCase() ||
        u.phone === identifier ||
        (u.email && u.email.toLowerCase() === identifier.toLowerCase())
      );

      if(exists){
        showError('registerError', 'User with this name/phone/email already exists');
        return;
      }

      // Create new user
      const isEmail = identifier.includes('@');
      const newUser = {
        id: uid(),
        name: name,
        phone: isEmail ? '' : identifier,
        email: isEmail ? identifier : '',
        password: password,
        about: bio || '',
        avatarColor: randomColor(),
        friends: []
      };

      users.push(newUser);
      DB.save(KEY.USERS, users);
      DB.save(KEY.CUR, newUser);

      showSuccess('registerError', 'Account created! Redirecting...');
      setTimeout(()=>{
        window.location.href = 'chat.html';
      }, 1000);
    });

    /* Check if already logged in */
    const currentUser = DB.load(KEY.CUR, null);
    if(currentUser){
      const rememberMe = localStorage.getItem('rc_remember') === 'true';
      if(rememberMe){
        window.location.href = 'chat.html';
      }
    }

    console.log('üîê Regent Connect Auth loaded. Demo users: Philip, Nana, Akosua (password: demo123)');

    // AI Button Handler
    function openAIWithPrompt() {
      const choice = confirm('Would you like to try RegentAI without logging in?\n\nClick OK to use AI now, or Cancel to login first.');
      
      if (choice) {
        // Go to public AI
        window.location.href = 'ai-public.html';
      } else {
        // Focus on login form
        document.getElementById('loginUsername').focus();
        showNotification('Please login to access all features including RegentAI with your account', 'info');
      }
    }

    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 16px 24px;
        background: ${type === 'info' ? 'linear-gradient(135deg, #667eea, #764ba2)' : 'linear-gradient(135deg, #4f46e5, #06b6d4)'};
        color: white;
        border-radius: 12px;
        box-shadow: 0 8px 24px rgba(0,0,0,0.3);
        z-index: 10000;
        max-width: 400px;
        animation: slideIn 0.3s ease-out;
      `;
      notification.textContent = message;
      
      const style = document.createElement('style');
      style.textContent = `
        @keyframes slideIn {
          from { transform: translateX(400px); opacity: 0; }
          to { transform: translateX(0); opacity: 1; }
        }
      `;
      document.head.appendChild(style);
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'slideIn 0.3s ease-out reverse';
        setTimeout(() => notification.remove(), 300);
      }, 4000);
    }
  </script>
</body>
</html>
